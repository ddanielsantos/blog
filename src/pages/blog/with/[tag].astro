---
import Postlist from "@components/post-list.astro";
import Layout from "@layouts/layout.astro";
import { getPosts } from "@lib/getPosts.astro";
import { getUniqueTags } from "@lib/getUniqueTags.astro";

let { tag } = Astro.params;
tag ??= "";

export const getStaticPaths = async () => {
  const posts = await getPosts();
  const uniqueTags = getUniqueTags(posts);

  return uniqueTags.map((tag) => ({ params: { tag } }));
};

const postsWithTag = await getPosts({ filter: { tag } });
---

<Layout title={"ddaniel.me | posts with " + tag}>
  <h1>Posts with: {tag}</h1>
  <Postlist posts={postsWithTag} />
</Layout>
