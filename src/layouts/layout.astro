---
import { ClientRouter } from 'astro:transitions';
import type { CollectionEntry } from "astro:content";
import Header from "@components/header.astro";
import MetaTags from "@components/meta-tags.astro";
import VerifyBadge from "@components/verify-badge.astro";
import { BackButton } from "@components/back-button.jsx";
import { getOgImageURL } from "@lib/getOgImageURL";

import '../styles/global.css'
import './global.css'

const { frontmatter, slug } = Astro.props as {
  frontmatter?: CollectionEntry<"blog">["data"],
  slug: string,
};
const title = frontmatter?.title;

const ogImageURL = await getOgImageURL(frontmatter);
const url = new URL(Astro.url.pathname, Astro.site);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <script src="https://app.rybbit.io/api/script.js" data-site-id="215" defer></script>

    <MetaTags
      href={url.href}
      ogImageURL={ogImageURL}
      title={"ddaniel.me"}
      description="Website pessoal do Daniel"
      frontmatter={frontmatter}
    />

    <title>{title || "ddaniel.me"}</title>
    <ClientRouter/>
    <script>
      function setupCopyButtons() {
        document.querySelectorAll("pre.astro-code").forEach((preElement) => {
          if (preElement.querySelector("button[data-copy]")) return;
          
          const codeText = preElement.textContent || "";
          
          const button = document.createElement("button");
          button.setAttribute("data-copy", "true");
          button.className = "absolute top-2 right-2 px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors";
          button.textContent = "Copiar";
          button.title = "Copiar código";
          
          button.addEventListener("click", async () => {
            button.classList.add("clicked");
            await navigator.clipboard.writeText(codeText);
            button.textContent = "✓";
            setTimeout(() => {
              button.textContent = "Copiar";
              button.classList.remove("clicked");
            }, 2000);
          });
          
          preElement.appendChild(button);
        });
      }
      
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", setupCopyButtons);
      } else {
        setupCopyButtons();
      }
      
      document.addEventListener("astro:after-swap", setupCopyButtons);
    </script>
  </head>
  <body>
    <Header />
    <main class="w-full flex flex-col p-8">
      <div
        class="w-full max-w-xl self-center flex flex-col gap-10 sm:my-20 my-10"
        transition:animate="fade"
      >
        {frontmatter?.title && (
            <>
              <BackButton client:load/>
            </>
        )

      }
        {frontmatter?.title && <h1>{frontmatter.title}</h1>}
        {
          frontmatter?.tags || frontmatter?.signature ? (
            <ul class="flex gap-2 tag-group">
              {frontmatter?.tags &&
                frontmatter.tags.map((tag: string) => (
                  <li>
                    <a
                      class="border-[1px] border-gray-300 dark:border-gray-700 text-xs py-1 px-2 rounded-md hover:underline tag"
                      href={"/blog/with/" + tag}
                    >
                      #{tag}
                    </a>
                  </li>
                ))}
              <VerifyBadge signature={frontmatter?.signature} />
            </ul>
          ) : null
        }
        <slot />
      </div>
    </main>
  </body>
</html>
